<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kiosk Screensaver</title>
    <style>
      /* RESET EVERYTHING FOR EDGE-TO-EDGE: */
      html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: black; }
    </style>
  </head>

  <body>
    <div id="screensaver" class="fixed inset-0">
      <% if @slides.any? %>
        <img
          id="screensaver-image"
          src="<%= url_for(@slides.first.image) %>"
          alt="<%= @slides.first.title %>"
          style="position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover;"
        />
      <% else %>
        <div style="display:flex; align-items:center; justify-content:center; width:100%; height:100%;">
          <p style="color:white; font-size:24px;">No slides scheduled.</p>
        </div>
      <% end %>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const slides = [
          <% @slides.each do |s| %>
            { url: "<%= url_for(s.image) %>", duration: <%= s.display_seconds %> },
          <% end %>
        ];
        let idx = 0;
        const img = document.getElementById("screensaver-image");
        const exitUrl = "<%= @exit_url %>";

        function nextSlide() {
          idx = (idx + 1) % slides.length;
          img.src = slides[idx].url;
          schedule();
        }
        function schedule() {
          clearTimeout(window._timer);
          window._timer = setTimeout(nextSlide, slides[idx].duration * 1000);
        }
        function exitNow() {
          window.location.href = exitUrl;
        }

        if (slides.length) schedule();
        document.addEventListener("mousemove", exitNow, { once: true });
        document.addEventListener("keydown",  exitNow, { once: true });
      });
    </script>
  </body>
</html>

